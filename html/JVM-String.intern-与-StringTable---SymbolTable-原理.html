<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
<h1>JVM String.intern 与 StringTable - SymbolTable 原理</h1>
<p>2022-07-01T08:27:15.537+0800</p>
<p><p><strong>问题引入</strong></p>
<p>以下代码为Java 字符串 最常见的问题，很多读者全靠背，对其中的原理一点都不清楚，导致容易出现问题，笔者在B站（<a href="https://www.bilibili.com/video/BV1iQ4y1U7qh?spm_id_from=333.999.0.0" target="_blank">https://www.bilibili.com/video/BV1iQ4y1U7qh?spm_id_from=333.999.0.0</a>）中通过视频讲解了其中原理。但是还是有读者不能理解其中的精髓，好在我们在混沌学堂中，详细讲解了ELF文件的字符串表和符号表的原理，以其原理来打通StringTable与SymbolTable的原理非常之轻松，且愉快。在本文的背后，笔者再解释以下的结果为什么会是如此。</p>
<p>注：由于JDK 8 市场占有率较高，所以笔者以此版本来做分析，若读者需要研究高版本，可以根据本文提示来找到对应高版本入口自行研究。</p>
<p><span style="color: rgb(200, 143, 208);">public</span> <span style="color: rgb(200, 143, 208);">class</span> <span style="color: rgb(141, 141, 240);">Demo</span> {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">public</span> <span style="color: rgb(200, 143, 208);">static</span> <span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(184, 191, 198);">main</span>(<span style="color: rgb(28, 198, 133);">String</span>[] <span style="color: rgb(184, 191, 198);">args</span>){</p>
<p><span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(210, 107, 107);">"abc"</span>;</p>
<p><span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">b</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(210, 107, 107);">"ab"</span> <span style="color: rgb(184, 191, 198);">+</span> <span style="color: rgb(210, 107, 107);">"c"</span>;</p>
<p><span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">c</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(200, 143, 208);">new</span> <span style="color: rgb(28, 198, 133);">String</span>(<span style="color: rgb(210, 107, 107);">"abc"</span>);</p>
<p><span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">d</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(200, 143, 208);">new</span> <span style="color: rgb(28, 198, 133);">String</span>(<span style="color: rgb(210, 107, 107);">"abce"</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">e</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(200, 143, 208);">new</span> <span style="color: rgb(28, 198, 133);">String</span>( <span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">+</span> <span style="color: rgb(184, 191, 198);">b</span> );</p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">a</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">b</span>); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">b</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">b</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">b</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">c</span>); <span style="color: rgb(218, 146, 74);">// false</span></p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">c</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">c</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// false</span></p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">d</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">d</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// false</span></p>
<p><span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">e</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">e</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p>&nbsp;}</p>
<p>}</p>
<p><strong>字节码层面</strong></p>
<p>“物有本末，事有终始，知其先后，则近道矣”，还记得笔者在混沌学堂说过的话么：研究底层原理就如同 jc 破案，掌握所有证据链、动机、手法、人证、物证，所以我们需要先看看字节码层面到底干了什么，然后再深入到JVM源码，看看字节码又干了什么，于是乎，真相浮出水面~。</p>
<p>咳咳，字节码貌似有点长，不过不打紧，因为都是重复的字节码，关键的字节码也就：ldc 字节码而已，该字节码用于解析字符串引用，比如 ldc #2，表示将 2 号常量池 也即 String 常量池中的 abc 引用放到操作数栈顶（额，这里假设 读者 知道 Java 栈帧包含：局部变量表、操作数栈、指向常量池指针~）。</p>
<p>通过字节码我们得知如下信息：</p>
<ol>
 <li>Java 栈帧的局部变量表中，1 slot 存放 "abc" 的引用 这里 变量为 a</li>
 <li>Java 栈帧的局部变量表中，2 slot 存放 "abc" 的引用 这里 变量为 b（编译器将："ab" + "c" 优化为 "abc"）</li>
 <li>Java 栈帧的局部变量表中，3 slot 存放 new String("abc") 的引用 这里 变量为 c</li>
 <li>Java 栈帧的局部变量表中，4 slot 存放 new String("abce") 的引用 这里 变量为 d</li>
 <li>Java 栈帧的局部变量表中，5 slot 存放 new String( a + b ) 的引用 这里 变量为 e（编译器通将：a 和 b 字符串引用 通过 StringBuilder 的 append 方法 进行封装，所以这里实际存储为 StringBuilder 的引用 ）</li>
 <li>在常量池中：String 常量池 中 指向 utf8 常量池 ，而对于 utf8 常量池 来说，其中就保留了 对应的字面量信息。如：#2 = String #28 ， #28 = Utf8 abc 其他 字面量依旧如此（有没有发现：ELF 中的 符号表持有 字符串表的下标，字符串表 包含 实际编码的字符串信息，详细 参考 混沌学堂 ELF 系列）</li>
</ol>
<p><span style="color: rgb(184, 191, 198);">Constant</span> <span style="color: rgb(184, 191, 198);">pool</span>:</p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#1</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#14</span>.<span style="color: rgb(184, 191, 198);">#27</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/Object."&lt;init&gt;":()V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#2</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(28, 198, 133);">String</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#28</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// abc</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#3</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#29</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/String</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#4</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#3</span>.<span style="color: rgb(184, 191, 198);">#30</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/String."&lt;init&gt;":(Ljava/lang/String;)V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#5</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(28, 198, 133);">String</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#31</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// abce</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#6</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#32</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/StringBuilder</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#7</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#6</span>.<span style="color: rgb(184, 191, 198);">#27</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/StringBuilder."&lt;init&gt;":()V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#8</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#6</span>.<span style="color: rgb(184, 191, 198);">#33</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">StringBuilder.append:</a><span style="color: rgb(218, 146, 74);">(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#9</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#6</span>.<span style="color: rgb(184, 191, 198);">#34</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/StringBuilder.toString:()Ljava/lang/String;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#10</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Fieldref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#35</span>.<span style="color: rgb(184, 191, 198);">#36</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#11</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#3</span>.<span style="color: rgb(184, 191, 198);">#37</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">String.intern:</a><span style="color: rgb(218, 146, 74);">()Ljava/lang/String;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#12</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Methodref</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#38</span>.<span style="color: rgb(184, 191, 198);">#39</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#13</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#40</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Demo</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#14</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#41</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/Object</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#15</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">&lt;init&gt;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#16</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;()<span style="color: rgb(184, 191, 198);">V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#17</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Code</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#18</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">LineNumberTable</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#19</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">main</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#20</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;([<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">String</span>;)<span style="color: rgb(184, 191, 198);">V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#21</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">StackMapTable</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#22</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#42</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// "[Ljava/lang/String;"</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#23</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#29</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/String</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#24</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#43</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/io/PrintStream</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#25</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">SourceFile</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#26</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">demo</span>.<span style="color: rgb(184, 191, 198);">java</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#27</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#15</span>:<span style="color: rgb(184, 191, 198);">#16</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// "&lt;init&gt;":()V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#28</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">abc</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#29</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">java/lang/</span><span style="color: rgb(28, 198, 133);">String</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#30</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#15</span>:<span style="color: rgb(184, 191, 198);">#44</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// "&lt;init&gt;":(Ljava/lang/String;)V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#31</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">abce</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#32</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">java/lang/</span><span style="color: rgb(28, 198, 133);">StringBuilder</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#33</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#45</span>:<span style="color: rgb(184, 191, 198);">#46</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// append:(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#34</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#47</span>:<span style="color: rgb(184, 191, 198);">#48</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// toString:()Ljava/lang/String;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#35</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#49</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/lang/System</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#36</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#50</span>:<span style="color: rgb(184, 191, 198);">#51</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// out:Ljava/io/PrintStream;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#37</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#52</span>:<span style="color: rgb(184, 191, 198);">#48</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// intern:()Ljava/lang/String;</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#38</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Class</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#43</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// java/io/PrintStream</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#39</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NameAndType</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#53</span>:<span style="color: rgb(184, 191, 198);">#54</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// println:(Z)V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#40</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Demo</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#41</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">java/lang/</span><span style="color: rgb(28, 198, 133);">Object</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#42</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">String</span>;</p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#43</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">java/io/PrintStream</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#44</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">String</span>;)<span style="color: rgb(184, 191, 198);">V</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#45</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">append</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#46</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">String</span>;)<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">StringBuilder</span>;</p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#47</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">toString</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#48</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;()<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">String</span>;</p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#49</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">java/lang/System</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#50</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">out</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#51</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Ljava/io/PrintStream</span>;</p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#52</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">intern</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#53</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">println</span></p>
<p>&nbsp;<span style="color: rgb(184, 191, 198);">#54</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">Utf8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span style="color: rgb(184, 191, 198);">Z</span>)<span style="color: rgb(184, 191, 198);">V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p><span style="color: rgb(200, 143, 208);">public</span> <span style="color: rgb(200, 143, 208);">static</span> <span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(141, 141, 240);">main</span>(<span style="color: rgb(184, 191, 198);">java</span>.<span style="color: rgb(184, 191, 198);">lang</span>.<span style="color: rgb(28, 198, 133);">String</span>[]);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">descriptor</span>: ([<span style="color: rgb(184, 191, 198);">Ljava/lang/</span><span style="color: rgb(28, 198, 133);">String</span>;)<span style="color: rgb(184, 191, 198);">V</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">flags</span>: <span style="color: rgb(184, 191, 198);">ACC_PUBLIC</span>, <span style="color: rgb(184, 191, 198);">ACC_STATIC</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Code</span>:</p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">stack=</span><span style="color: rgb(100, 171, 143);">4</span>, <span style="color: rgb(184, 191, 198);">locals=</span><span style="color: rgb(100, 171, 143);">6</span>, <span style="color: rgb(184, 191, 198);">args_size=</span><span style="color: rgb(100, 171, 143);">1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">0</span>: <span style="color: rgb(184, 191, 198);">ldc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// String abc</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">2</span>: <span style="color: rgb(184, 191, 198);">astore_1</span>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 对应代码：String a = "abc";</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">3</span>: <span style="color: rgb(184, 191, 198);">ldc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// String abc</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">5</span>: <span style="color: rgb(184, 191, 198);">astore_2</span>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 对应代码：String b = "ab" + "c"; </span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">6</span>: <span style="color: rgb(200, 143, 208);">new</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// class java/lang/String</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">9</span>: <span style="color: rgb(184, 191, 198);">dup</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">10</span>: <span style="color: rgb(184, 191, 198);">ldc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#2</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// String abc</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">12</span>: <span style="color: rgb(184, 191, 198);">invokespecial</span> <span style="color: rgb(184, 191, 198);">#4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/String."&lt;init&gt;":(Ljava/lang/String;)V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">15</span>: <span style="color: rgb(184, 191, 198);">astore_3</span>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 对应代码：String c = new String("abc");&nbsp;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">16</span>: <span style="color: rgb(200, 143, 208);">new</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// class java/lang/String</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">19</span>: <span style="color: rgb(184, 191, 198);">dup</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">20</span>: <span style="color: rgb(184, 191, 198);">ldc</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#5</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// String abce</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">22</span>: <span style="color: rgb(184, 191, 198);">invokespecial</span> <span style="color: rgb(184, 191, 198);">#4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/String."&lt;init&gt;":(Ljava/lang/String;)V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">25</span>: <span style="color: rgb(184, 191, 198);">astore</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">4</span>&nbsp;<span style="color: rgb(218, 146, 74);">// 对应代码：String d = new String("abce");</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">27</span>: <span style="color: rgb(200, 143, 208);">new</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#3</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// class java/lang/String</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">30</span>: <span style="color: rgb(184, 191, 198);">dup</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">31</span>: <span style="color: rgb(200, 143, 208);">new</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#6</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// class java/lang/StringBuilder</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">34</span>: <span style="color: rgb(184, 191, 198);">dup</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">35</span>: <span style="color: rgb(184, 191, 198);">invokespecial</span> <span style="color: rgb(184, 191, 198);">#7</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/StringBuilder."&lt;init&gt;":()V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">38</span>: <span style="color: rgb(184, 191, 198);">aload_1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">39</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">StringBuilder.append:</a><span style="color: rgb(218, 146, 74);">(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">42</span>: <span style="color: rgb(184, 191, 198);">aload_2</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">43</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#8</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">StringBuilder.append:</a><span style="color: rgb(218, 146, 74);">(Ljava/lang/String;)Ljava/lang/StringBuilder;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">46</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#9</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/StringBuilder.toString:()Ljava/lang/String;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">49</span>: <span style="color: rgb(184, 191, 198);">invokespecial</span> <span style="color: rgb(184, 191, 198);">#4</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/String."&lt;init&gt;":(Ljava/lang/String;)V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">52</span>: <span style="color: rgb(184, 191, 198);">astore</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">5</span>&nbsp;<span style="color: rgb(218, 146, 74);">// 对应代码：String e = new String( a + b );&nbsp;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">54</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">57</span>: <span style="color: rgb(184, 191, 198);">aload_1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">58</span>: <span style="color: rgb(184, 191, 198);">aload_1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">59</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#11</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">String.intern:</a><span style="color: rgb(218, 146, 74);">()Ljava/lang/String;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">62</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">69</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">65</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">66</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">70</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">69</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">70</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">73</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">76</span>: <span style="color: rgb(184, 191, 198);">aload_1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">77</span>: <span style="color: rgb(184, 191, 198);">aload_2</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">78</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">85</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">81</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">82</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">86</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">85</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">86</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">89</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">92</span>: <span style="color: rgb(184, 191, 198);">aload_2</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">93</span>: <span style="color: rgb(184, 191, 198);">aload_2</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">94</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#11</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">String.intern:</a><span style="color: rgb(218, 146, 74);">()Ljava/lang/String;</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">97</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">104</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">100</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">101</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">105</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">104</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">105</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">108</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">111</span>: <span style="color: rgb(184, 191, 198);">aload_2</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">112</span>: <span style="color: rgb(184, 191, 198);">aload_3</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">113</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">120</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">116</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">117</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">121</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">120</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">121</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">124</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">127</span>: <span style="color: rgb(184, 191, 198);">aload_3</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">128</span>: <span style="color: rgb(184, 191, 198);">aload_3</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">129</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#11</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">String.intern:</a><span style="color: rgb(218, 146, 74);">()Ljava/lang/String;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">132</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">139</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">135</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">136</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">140</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">139</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">140</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">143</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">146</span>: <span style="color: rgb(184, 191, 198);">aload</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">4</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">148</span>: <span style="color: rgb(184, 191, 198);">aload</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">4</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">150</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#11</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">String.intern:</a><span style="color: rgb(218, 146, 74);">()Ljava/lang/String;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">153</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">160</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">156</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">157</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">161</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">160</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">161</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">164</span>: <span style="color: rgb(184, 191, 198);">getstatic</span>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">#10</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Field java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">System.out:Ljava/io/PrintStream</a><span style="color: rgb(218, 146, 74);">;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">167</span>: <span style="color: rgb(184, 191, 198);">aload</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">5</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">169</span>: <span style="color: rgb(184, 191, 198);">aload</span>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">5</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">171</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#11</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/lang/</span><a href="http://about:blank" target="_blank" style="color: rgb(218, 146, 74);">String.intern:</a><span style="color: rgb(218, 146, 74);">()Ljava/lang/String;</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">174</span>: <span style="color: rgb(184, 191, 198);">if_acmpne</span>&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">181</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">177</span>: <span style="color: rgb(184, 191, 198);">iconst_1</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">178</span>: <span style="color: rgb(200, 143, 208);">goto</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">182</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">181</span>: <span style="color: rgb(184, 191, 198);">iconst_0</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">182</span>: <span style="color: rgb(184, 191, 198);">invokevirtual</span> <span style="color: rgb(184, 191, 198);">#12</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Method java/io/PrintStream.println:(Z)V</span></p>
<p>&nbsp;&nbsp;&nbsp;<span style="color: rgb(100, 171, 143);">185</span>: <span style="color: rgb(200, 143, 208);">return</span></p>
<p><strong>JVM 层面</strong></p>
<p>那么，了解字节码后，直接上 JVM 源码，由于源码涉及层面较多，笔者这里删减部分不相关代码，直接看真相。</p>
<p><strong>类加载常量池解析原理</strong></p>
<p>对于常量池而言，将会在类加载的时候进行解析，所以我们先看解析过程，毕竟class文件始终只是静态数据，在JVM中肯定需要加载放到指定位置等待使用（再次强调：不要关注C++细节哈，当Java看，看不懂 的话，看注释）。通过源码我们得知如下信息：</p>
<ol>
 <li>对于 JVM_CONSTANT_String 字符串常量池，将会在ConstantPool 常量池对象中保存 字符串常量池下标与 utf 8 的映射 通过 string_index_at_put 方法</li>
 <li>对于 JVM_CONSTANT_Utf8 字符串常量池，将会保存 _cp-&gt;symbol_at_put(index, result) utf8 常量池下标与Symbol 引用的映射，而字面量最终将会被添加到 SymbolTable 中</li>
</ol>
<p><span style="color: rgb(184, 191, 198);">instanceKlassHandle</span> <span style="color: rgb(141, 141, 240);">ClassFileParser::parseClassFile</span>(<span style="color: rgb(184, 191, 198);">Symbol*</span> <span style="color: rgb(184, 191, 198);">name</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">ClassLoaderData*</span> <span style="color: rgb(184, 191, 198);">loader_data</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">protection_domain</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">KlassHandle</span> <span style="color: rgb(184, 191, 198);">host_klass</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">GrowableArray&lt;Handle&gt;*</span> <span style="color: rgb(184, 191, 198);">cp_patches</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">TempNewSymbol&amp;</span> <span style="color: rgb(184, 191, 198);">parsed_name</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">bool</span> <span style="color: rgb(184, 191, 198);">verify</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// Constant pool 直接看这里</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">constantPoolHandle</span> <span style="color: rgb(184, 191, 198);">cp</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">parse_constant_pool</span>(<span style="color: rgb(184, 191, 198);">CHECK_</span>(<span style="color: rgb(184, 191, 198);">nullHandle</span>));</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(184, 191, 198);">constantPoolHandle</span> <span style="color: rgb(141, 141, 240);">ClassFileParser::parse_constant_pool</span>(<span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// parsing constant pool entries 转换每一个 #1 - #N 的常量池</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">parse_constant_pool_entries</span>(<span style="color: rgb(184, 191, 198);">length</span>, <span style="color: rgb(184, 191, 198);">CHECK_</span>(<span style="color: rgb(184, 191, 198);">nullHandle</span>));</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 由于常量池类型较多，我们这里只涉及到：String 与 Utf 8 就可以</span></p>
<p><span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(141, 141, 240);">ClassFileParser::parse_constant_pool_entries</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">length</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// parsing Index 0 is unused 开始转换，0 下标 将不使用，也即常量池将从 #1 开始解析</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">for</span> (<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">index</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(100, 171, 143);">1</span>; <span style="color: rgb(184, 191, 198);">index</span> <span style="color: rgb(184, 191, 198);">&lt;</span> <span style="color: rgb(184, 191, 198);">length</span>; <span style="color: rgb(184, 191, 198);">index++</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">u1</span> <span style="color: rgb(184, 191, 198);">tag</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">cfs-&gt;get_u1_fast</span>(); <span style="color: rgb(218, 146, 74);">// 获取一个字节的常量池标签（也即：String 或者 Utf 8）</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">switch</span> (<span style="color: rgb(184, 191, 198);">tag</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">case</span> <span style="color: rgb(184, 191, 198);">JVM_CONSTANT_String</span> :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">cfs-&gt;guarantee_more</span>(<span style="color: rgb(100, 171, 143);">3</span>, <span style="color: rgb(184, 191, 198);">CHECK</span>);&nbsp;<span style="color: rgb(218, 146, 74);">// 保证后面字节存在 string_index, tag/access_flags</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">u2</span> <span style="color: rgb(184, 191, 198);">string_index</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">cfs-&gt;get_u2_fast</span>(); <span style="color: rgb(218, 146, 74);">// 获取指向 utf8 的下标</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">_cp-&gt;string_index_at_put</span>(<span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">string_index</span>); <span style="color: rgb(218, 146, 74);">// 将当前常量池下标与指向utf8 常量池的下标保存到ConstantPool 类中（在本示例中，也即保存：2 和 28，其他的字面量依旧如此 ）</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">break</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">case</span> <span style="color: rgb(184, 191, 198);">JVM_CONSTANT_Utf8</span> :</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">cfs-&gt;guarantee_more</span>(<span style="color: rgb(100, 171, 143);">2</span>, <span style="color: rgb(184, 191, 198);">CHECK</span>);&nbsp;<span style="color: rgb(218, 146, 74);">// 保证后面字节存在 utf8_length 也即字符串长度</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">u2</span>&nbsp;<span style="color: rgb(184, 191, 198);">utf8_length</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">cfs-&gt;get_u2_fast</span>(); <span style="color: rgb(218, 146, 74);">// 获取 2 字节长度</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">u1*</span> <span style="color: rgb(184, 191, 198);">utf8_buffer</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">cfs-&gt;get_u1_buffer</span>(); <span style="color: rgb(218, 146, 74);">// 获取字符串缓冲区（这里其实就是跟在2字节长度后面的真实字符串的字符指针，也即：length + content）</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">cfs-&gt;skip_u1_fast</span>(<span style="color: rgb(184, 191, 198);">utf8_length</span>); <span style="color: rgb(218, 146, 74);">// 让当前流指针掠过utf8字符串，指向下一个常量池</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">unsigned</span> <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">hash</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Symbol*</span> <span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">SymbolTable::lookup_only</span>((<span style="color: rgb(28, 198, 133);">char*</span>)<span style="color: rgb(184, 191, 198);">utf8_buffer</span>, <span style="color: rgb(184, 191, 198);">utf8_length</span>, <span style="color: rgb(184, 191, 198);">hash</span>); <span style="color: rgb(218, 146, 74);">// 看看SymbolTable表中是否存在该 字面量 ， 若不存在，那么将该字面量放入 SymbolTable 中</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">NULL</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">names</span>[<span style="color: rgb(184, 191, 198);">names_count</span>] <span style="color: rgb(184, 191, 198);">=</span> (<span style="color: rgb(28, 198, 133);">char*</span>)<span style="color: rgb(184, 191, 198);">utf8_buffer</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">lengths</span>[<span style="color: rgb(184, 191, 198);">names_count</span>] <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">utf8_length</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">indices</span>[<span style="color: rgb(184, 191, 198);">names_count</span>] <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">index</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">hashValues</span>[<span style="color: rgb(184, 191, 198);">names_count++</span>] <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">hash</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">names_count</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">SymbolTable::symbol_alloc_batch_size</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">SymbolTable::new_symbols</span>(<span style="color: rgb(184, 191, 198);">_loader_data</span>, <span style="color: rgb(184, 191, 198);">_cp</span>, <span style="color: rgb(184, 191, 198);">names_count</span>, <span style="color: rgb(184, 191, 198);">names</span>, <span style="color: rgb(184, 191, 198);">lengths</span>, <span style="color: rgb(184, 191, 198);">indices</span>, <span style="color: rgb(184, 191, 198);">hashValues</span>, <span style="color: rgb(184, 191, 198);">CHECK</span>);&nbsp;<span style="color: rgb(218, 146, 74);">// 将字面量保存到 SymbolTable 中，而 _cp-&gt;symbol_at_put 将在其中完成映射</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">names_count</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(100, 171, 143);">0</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span style="color: rgb(200, 143, 208);">else</span> { <span style="color: rgb(218, 146, 74);">// 若字面量已经存在，那么保存 当前 utf8 下标 和 Symbol的引用映射</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">_cp-&gt;symbol_at_put</span>(<span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">result</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">break</span>;&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;}</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 常量池对象，用于保存所有常量池信息</span></p>
<p><span style="color: rgb(200, 143, 208);">class</span> <span style="color: rgb(141, 141, 240);">ConstantPool</span> : <span style="color: rgb(200, 143, 208);">public</span> <span style="color: rgb(184, 191, 198);">Metadata</span> {</p>
<p>​</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// which 常量池下标，string_index utf8 下标</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(184, 191, 198);">string_index_at_put</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">string_index</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">tag_at_put</span>(<span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(184, 191, 198);">JVM_CONSTANT_StringIndex</span>); <span style="color: rgb(218, 146, 74);">// 在which下标处存放 JVM_CONSTANT_StringIndex，将String常量池转为 JVM_CONSTANT_StringIndex 下标类型的常量池</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">*int_at_addr</span>(<span style="color: rgb(184, 191, 198);">which</span>) <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">string_index</span>; <span style="color: rgb(218, 146, 74);">// 将 utf8 下标放入对象末尾的空间中，下标同样为 which</span></p>
<p>&nbsp;}</p>
<p>​</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// which 常量池下标，s 为符号引用</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(184, 191, 198);">symbol_at_put</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(184, 191, 198);">Symbol*</span> <span style="color: rgb(184, 191, 198);">s</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">tag_at_put</span>(<span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(184, 191, 198);">JVM_CONSTANT_Utf8</span>); <span style="color: rgb(218, 146, 74);">// 在which下标处存放 JVM_CONSTANT_Utf8</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">*symbol_at_addr</span>(<span style="color: rgb(184, 191, 198);">which</span>) <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">s</span>; <span style="color: rgb(218, 146, 74);">// 将Symbol地址信息保存到数组下标为which处</span></p>
<p>&nbsp;}</p>
<p>​</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Array&lt;u1&gt;*</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">_tags</span>;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// tag数组，保存常量池内容信息，每个数组单元 1 字节</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(184, 191, 198);">tag_at_put</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(184, 191, 198);">jbyte</span> <span style="color: rgb(184, 191, 198);">t</span>)&nbsp;&nbsp;&nbsp;&nbsp;{ <span style="color: rgb(184, 191, 198);">tags</span>()<span style="color: rgb(184, 191, 198);">-&gt;at_put</span>(<span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(184, 191, 198);">t</span>); } <span style="color: rgb(218, 146, 74);">// 在对应数组下标为which处放入存放t</span></p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 获取当前ConstantPool对象末尾内存的 intptr_t 指针（也即该内存解释为：intptr_t 数组，在不同平台上该值将随之不同，比如在 64 为中，该值为 64位）</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">intptr_t*</span> <span style="color: rgb(184, 191, 198);">base</span>() <span style="color: rgb(200, 143, 208);">const</span> { <span style="color: rgb(200, 143, 208);">return</span> (<span style="color: rgb(184, 191, 198);">intptr_t*</span>) (((<span style="color: rgb(28, 198, 133);">char*</span>) <span style="color: rgb(200, 143, 208);">this</span>) <span style="color: rgb(184, 191, 198);">+</span> <span style="color: rgb(200, 143, 208);">sizeof</span>(<span style="color: rgb(184, 191, 198);">ConstantPool</span>)); }</p>
<p>&nbsp;&nbsp;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 获取当前 ConstantPool 类 内存末尾地址为which处的指针，比如： ConstantPool 占用 8byte，那么这里的 &amp;base() 就等于获取末尾8byte的指针，而该对象内存末尾将用于存放 常量池对应的数据信息（末尾为 intptr_t 数组）~ </span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">jint*</span> <span style="color: rgb(184, 191, 198);">int_at_addr</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>) <span style="color: rgb(200, 143, 208);">const</span> {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> (<span style="color: rgb(184, 191, 198);">jint*</span>) <span style="color: rgb(184, 191, 198);">&amp;base</span>()[<span style="color: rgb(184, 191, 198);">which</span>];</p>
<p>&nbsp;}</p>
<p>​</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 获取ConstantPool对象 末尾下标为which处的地址，并将其转为 Symbol** ，也即二级指针（注意：在混沌学堂说的，指针类型为内存空间的解释，这里将其解释为：保存一个指针的地址！）</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Symbol**</span> <span style="color: rgb(184, 191, 198);">symbol_at_addr</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>) <span style="color: rgb(200, 143, 208);">const</span> {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> (<span style="color: rgb(184, 191, 198);">Symbol**</span>) <span style="color: rgb(184, 191, 198);">&amp;base</span>()[<span style="color: rgb(184, 191, 198);">which</span>];</p>
<p>&nbsp;}</p>
<p>​</p>
<p>}</p>
<p><strong>ldc 字节码原理</strong></p>
<p>我们从上面的分析了解到，ConstantPool对象的 Array<span style="color: inherit;">&lt;u1&gt;</span>* _tags 保存了常量池的类型，ConstantPool对象的末尾保存了常量池类型对应的数据，而对于UTF8而言，Symbol 引用保存在其中。那么接下来我们来看看ldc字节码的原理，看看ldc如何获取到字符串的引用信息。</p>
<p><span style="color: rgb(184, 191, 198);">CASE</span>(<span style="color: rgb(184, 191, 198);">_ldc</span>):{</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">u2</span> <span style="color: rgb(184, 191, 198);">index</span> <span style="color: rgb(184, 191, 198);">=</span>&nbsp;<span style="color: rgb(184, 191, 198);">pc</span>[<span style="color: rgb(100, 171, 143);">1</span>]; <span style="color: rgb(218, 146, 74);">// 获取ldc字节码后面指向常量池的下标</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">ConstantPool*</span> <span style="color: rgb(184, 191, 198);">constants</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">METHOD-&gt;constants</span>(); <span style="color: rgb(218, 146, 74);">// 获取常量池引用</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">switch</span> (<span style="color: rgb(184, 191, 198);">constants-&gt;tag_at</span>(<span style="color: rgb(184, 191, 198);">index</span>).<span style="color: rgb(184, 191, 198);">value</span>()) { <span style="color: rgb(218, 146, 74);">// 获取当前指向index处的常量池类型，也即tag数组对应下标处的类型，这里我们只需要看String即可（有读者可能会问：上面个不是保存的是：JVM_CONSTANT_StringIndex么，为啥这里是String，是这样的，那个值只是个临时值，在解析完常量池entry后，将会将其修改为JVM_CONSTANT_String，同时在对应下标处将会将其修改为JVM_CONSTANT_String，同时在ConstantPool对象末尾处的值将不再是utf8的下标，将会修改为Symbol的引用~学过ELF的道友，应该知道，这就是符号解析~）</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">case</span> <span style="color: rgb(184, 191, 198);">JVM_CONSTANT_String</span>:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">constants-&gt;resolved_references</span>()<span style="color: rgb(184, 191, 198);">-&gt;obj_at</span>(<span style="color: rgb(184, 191, 198);">index</span>); <span style="color: rgb(218, 146, 74);">// 获取到已经解析好的引用，不过我们这里压根没解析，只有Symbol引用（可能有读者不理解oop是什么，这里只需要知道：它就是Java的String对象引用就好了）</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">NULL</span>) { <span style="color: rgb(218, 146, 74);">// 首次调用，结果必然为空，所以进行解析（读者想想：是不是解析完了以后再次调用index下标的oop，就直接从resolved_references 中获取即可？）</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">CALL_VM</span>(<span style="color: rgb(184, 191, 198);">InterpreterRuntime::resolve_ldc</span>(<span style="color: rgb(184, 191, 198);">THREAD</span>, (<span style="color: rgb(184, 191, 198);">Bytecodes::Code</span>) <span style="color: rgb(184, 191, 198);">opcode</span>), <span style="color: rgb(184, 191, 198);">handle_exception</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">SET_STACK_OBJECT</span>(<span style="color: rgb(184, 191, 198);">THREAD-&gt;vm_result</span>(), <span style="color: rgb(100, 171, 143);">0</span>); <span style="color: rgb(218, 146, 74);">// 解析完成后将对象压入操作数栈中</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">THREAD-&gt;set_vm_result</span>(<span style="color: rgb(184, 191, 198);">NULL</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} <span style="color: rgb(200, 143, 208);">else</span> { <span style="color: rgb(218, 146, 74);">// 结果不为空，直接放入操作数栈即可</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">SET_STACK_OBJECT</span>(<span style="color: rgb(184, 191, 198);">result</span>, <span style="color: rgb(100, 171, 143);">0</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">break</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;}</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 接下来我们来看解析过程</span></p>
<p><span style="color: rgb(184, 191, 198);">IRT_ENTRY</span>(<span style="color: rgb(28, 198, 133);">void</span>, <span style="color: rgb(184, 191, 198);">InterpreterRuntime::resolve_ldc</span>(<span style="color: rgb(184, 191, 198);">JavaThread*</span> <span style="color: rgb(184, 191, 198);">thread</span>, <span style="color: rgb(184, 191, 198);">Bytecodes::Code</span> <span style="color: rgb(184, 191, 198);">bytecode</span>)) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Bytecode_loadconstant</span> <span style="color: rgb(184, 191, 198);">ldc</span>(<span style="color: rgb(184, 191, 198);">m</span>, <span style="color: rgb(184, 191, 198);">bci</span>(<span style="color: rgb(184, 191, 198);">thread</span>));</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">ldc</span>.<span style="color: rgb(184, 191, 198);">resolve_constant</span>(<span style="color: rgb(184, 191, 198);">CHECK</span>); <span style="color: rgb(218, 146, 74);">// 直接看这里</span></p>
<p>}</p>
<p><span style="color: rgb(184, 191, 198);">IRT_END</span></p>
<p>​</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">Bytecode_loadconstant::resolve_constant</span>(<span style="color: rgb(184, 191, 198);">TRAPS</span>) <span style="color: rgb(200, 143, 208);">const</span> {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">index</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">raw_index</span>();</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">ConstantPool*</span> <span style="color: rgb(184, 191, 198);">constants</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">_method-&gt;constants</span>();</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">has_cache_index</span>()) { <span style="color: rgb(218, 146, 74);">// 表示是否缓存，无伤大雅，看下面的else即可</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">constants-&gt;resolve_cached_constant_at</span>(<span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">THREAD</span>);</p>
<p>&nbsp;} <span style="color: rgb(200, 143, 208);">else</span> { <span style="color: rgb(218, 146, 74);">// 我们看这里</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">constants-&gt;resolve_constant_at</span>(<span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">THREAD</span>);</p>
<p>&nbsp;}</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">resolve_constant_at</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">constantPoolHandle</span> <span style="color: rgb(184, 191, 198);">h_this</span>(<span style="color: rgb(184, 191, 198);">THREAD</span>, <span style="color: rgb(200, 143, 208);">this</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">resolve_constant_at_impl</span>(<span style="color: rgb(184, 191, 198);">h_this</span>, <span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">_no_index_sentinel</span>, <span style="color: rgb(184, 191, 198);">THREAD</span>);</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">ConstantPool::resolve_constant_at_impl</span>(<span style="color: rgb(184, 191, 198);">constantPoolHandle</span> <span style="color: rgb(184, 191, 198);">this_oop</span>, <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">cache_index</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">result_oop</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NULL</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">throw_exception</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">tag_value</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">this_oop-&gt;tag_at</span>(<span style="color: rgb(184, 191, 198);">index</span>).<span style="color: rgb(184, 191, 198);">value</span>(); <span style="color: rgb(218, 146, 74);">// 获取tag 标签 index 下标处的常量池类型，这里我们只需要关注：JVM_CONSTANT_String</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">switch</span> (<span style="color: rgb(184, 191, 198);">tag_value</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">case</span> <span style="color: rgb(184, 191, 198);">JVM_CONSTANT_String</span>:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">result_oop</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">string_at_impl</span>(<span style="color: rgb(184, 191, 198);">this_oop</span>, <span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">cache_index</span>, <span style="color: rgb(184, 191, 198);">CHECK_NULL</span>); <span style="color: rgb(218, 146, 74);">// 看这里，通过string_at_impl方法 拿到了 Java的String 对象 oop</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">break</span>;</p>
<p>&nbsp;}</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">cache_index</span> <span style="color: rgb(184, 191, 198);">&gt;=</span> <span style="color: rgb(100, 171, 143);">0</span>) { <span style="color: rgb(218, 146, 74);">// 若指定缓存解析后的对象，那么在resolved_references下标处保存即可</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">result_handle</span>(<span style="color: rgb(184, 191, 198);">THREAD</span>, <span style="color: rgb(184, 191, 198);">result_oop</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">this_oop-&gt;resolved_references</span>()<span style="color: rgb(184, 191, 198);">-&gt;obj_at</span>(<span style="color: rgb(184, 191, 198);">cache_index</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">NULL</span>) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">this_oop-&gt;resolved_references</span>()<span style="color: rgb(184, 191, 198);">-&gt;obj_at_put</span>(<span style="color: rgb(184, 191, 198);">cache_index</span>, <span style="color: rgb(184, 191, 198);">result_handle</span>());</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">result_handle</span>();</p>
<p>&nbsp;&nbsp;&nbsp;} <span style="color: rgb(200, 143, 208);">else</span> {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">result</span>;</p>
<p>&nbsp;&nbsp;&nbsp;}</p>
<p>&nbsp;} <span style="color: rgb(200, 143, 208);">else</span> { <span style="color: rgb(218, 146, 74);">// 否则直接返回</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">result_oop</span>;</p>
<p>&nbsp;}</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 实际解析过程</span></p>
<p><span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">ConstantPool::string_at_impl</span>(<span style="color: rgb(184, 191, 198);">constantPoolHandle</span> <span style="color: rgb(184, 191, 198);">this_oop</span>, <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">obj_index</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 先在resolved_references中尝试获取，若已经解析，那么直接返回</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">str</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">this_oop-&gt;resolved_references</span>()<span style="color: rgb(184, 191, 198);">-&gt;obj_at</span>(<span style="color: rgb(184, 191, 198);">obj_index</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">str</span> <span style="color: rgb(184, 191, 198);">!=</span> <span style="color: rgb(184, 191, 198);">NULL</span>) <span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">str</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 否则，获取Symbol引用，然后调用StringTable::intern方法，将符号信息进行解析，然后生成oop，最后将oop 通过string_at_put方法放入到resolved_references数组中即可</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Symbol*</span> <span style="color: rgb(184, 191, 198);">sym</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">this_oop-&gt;unresolved_string_at</span>(<span style="color: rgb(184, 191, 198);">which</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">str</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">StringTable::intern</span>(<span style="color: rgb(184, 191, 198);">sym</span>, <span style="color: rgb(184, 191, 198);">CHECK_</span>(<span style="color: rgb(184, 191, 198);">NULL</span>));</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">this_oop-&gt;string_at_put</span>(<span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(184, 191, 198);">obj_index</span>, <span style="color: rgb(184, 191, 198);">str</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">str</span>;</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(141, 141, 240);">string_at_put</span>(<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">which</span>, <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">obj_index</span>, <span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">str</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">resolved_references</span>()<span style="color: rgb(184, 191, 198);">-&gt;obj_at_put</span>(<span style="color: rgb(184, 191, 198);">obj_index</span>, <span style="color: rgb(184, 191, 198);">str</span>);</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 根据Symbol符号引用，生成String oop</span></p>
<p><span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">StringTable::intern</span>(<span style="color: rgb(184, 191, 198);">Symbol*</span> <span style="color: rgb(184, 191, 198);">symbol</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">symbol</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">NULL</span>) <span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">NULL</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">ResourceMark</span> <span style="color: rgb(184, 191, 198);">rm</span>(<span style="color: rgb(184, 191, 198);">THREAD</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">length</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 获取经过unicode编码的字符数组</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">jchar*</span> <span style="color: rgb(184, 191, 198);">chars</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">symbol-&gt;as_unicode</span>(<span style="color: rgb(184, 191, 198);">length</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">string</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">intern</span>(<span style="color: rgb(184, 191, 198);">string</span>, <span style="color: rgb(184, 191, 198);">chars</span>, <span style="color: rgb(184, 191, 198);">length</span>, <span style="color: rgb(184, 191, 198);">CHECK_NULL</span>); <span style="color: rgb(218, 146, 74);">// 进行转换</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">result</span>;</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 转换操作</span></p>
<p><span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">StringTable::intern</span>(<span style="color: rgb(200, 143, 208);">const</span> <span style="color: rgb(28, 198, 133);">char*</span> <span style="color: rgb(184, 191, 198);">utf8_string</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">utf8_string</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">NULL</span>) <span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">NULL</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">ResourceMark</span> <span style="color: rgb(184, 191, 198);">rm</span>(<span style="color: rgb(184, 191, 198);">THREAD</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">length</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">UTF8::unicode_length</span>(<span style="color: rgb(184, 191, 198);">utf8_string</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">jchar*</span> <span style="color: rgb(184, 191, 198);">chars</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">NEW_RESOURCE_ARRAY</span>(<span style="color: rgb(184, 191, 198);">jchar</span>, <span style="color: rgb(184, 191, 198);">length</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">UTF8::convert_to_unicode</span>(<span style="color: rgb(184, 191, 198);">utf8_string</span>, <span style="color: rgb(184, 191, 198);">chars</span>, <span style="color: rgb(184, 191, 198);">length</span>); <span style="color: rgb(218, 146, 74);">// 进行UTF8编码</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">string</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">result</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">intern</span>(<span style="color: rgb(184, 191, 198);">string</span>, <span style="color: rgb(184, 191, 198);">chars</span>, <span style="color: rgb(184, 191, 198);">length</span>, <span style="color: rgb(184, 191, 198);">CHECK_NULL</span>); <span style="color: rgb(218, 146, 74);">// 完成转换</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">result</span>;</p>
<p>}</p>
<p>​</p>
<p><span style="color: rgb(218, 146, 74);">// 最终转换操作</span></p>
<p><span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(141, 141, 240);">StringTable::intern</span>(<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">string_or_null</span>, <span style="color: rgb(184, 191, 198);">jchar*</span> <span style="color: rgb(184, 191, 198);">name</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">len</span>, <span style="color: rgb(184, 191, 198);">TRAPS</span>) {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">unsigned</span> <span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">hashValue</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">hash_string</span>(<span style="color: rgb(184, 191, 198);">name</span>, <span style="color: rgb(184, 191, 198);">len</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">int</span> <span style="color: rgb(184, 191, 198);">index</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">the_table</span>()<span style="color: rgb(184, 191, 198);">-&gt;hash_to_index</span>(<span style="color: rgb(184, 191, 198);">hashValue</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 已经存在，那么直接返回</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">oop</span> <span style="color: rgb(184, 191, 198);">found_string</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">the_table</span>()<span style="color: rgb(184, 191, 198);">-&gt;lookup</span>(<span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">name</span>, <span style="color: rgb(184, 191, 198);">len</span>, <span style="color: rgb(184, 191, 198);">hashValue</span>);</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">found_string</span> <span style="color: rgb(184, 191, 198);">!=</span> <span style="color: rgb(184, 191, 198);">NULL</span>) <span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">found_string</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 否则根据 jchar* name 与 len 长度创建String对象</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">Handle</span> <span style="color: rgb(184, 191, 198);">string</span>;</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">if</span> (<span style="color: rgb(184, 191, 198);">!string_or_null</span>.<span style="color: rgb(184, 191, 198);">is_null</span>()) {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">string</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">string_or_null</span>;</p>
<p>&nbsp;} <span style="color: rgb(200, 143, 208);">else</span> {</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">string</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(184, 191, 198);">java_lang_String::create_from_unicode</span>(<span style="color: rgb(184, 191, 198);">name</span>, <span style="color: rgb(184, 191, 198);">len</span>, <span style="color: rgb(184, 191, 198);">CHECK_NULL</span>);<span style="color: rgb(218, 146, 74);">// 该方法，笔者不再追踪，因为这里面就是很简单的：new String()操作了，只不过在JVM级别来调用，涉及到JVM的其他细节，这里省略并不会影响整体流程，只需要把这里当作 new String（byte[]）即可</span></p>
<p>&nbsp;}</p>
<p>&nbsp;&nbsp;<span style="color: rgb(218, 146, 74);">// 将对象添加到StringTable中即可</span></p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">return</span> <span style="color: rgb(184, 191, 198);">the_table</span>()<span style="color: rgb(184, 191, 198);">-&gt;basic_add</span>(<span style="color: rgb(184, 191, 198);">index</span>, <span style="color: rgb(184, 191, 198);">string</span>, <span style="color: rgb(184, 191, 198);">name</span>, <span style="color: rgb(184, 191, 198);">len</span>,</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">hashValue</span>, <span style="color: rgb(184, 191, 198);">CHECK_NULL</span>);</p>
<p>}</p>
<p><strong>SymbolTable 与 StringTable</strong></p>
<p>至此，我们可以从上面的字节码原理中看到：</p>
<ol>
 <li>SymbolTable 保存 字面量 unicode 编码信息</li>
 <li>StringTable 保存 Java String oop 对象信息</li>
</ol>
<p><strong>最终解释</strong></p>
<p>最后我们根据StringTable 与 SymbolTable 来解释如下结果：</p>
<ol>
 <li>a == a.intern() ： a字面量已经在String 常量池中存在，在ldc时解析生成了String对象，并放入了resolved_references，所以a与a.intern() 将返回同一个对象</li>
 <li>a == b ：b已经被编译器优化成 abc 所以同 1所述</li>
 <li>b == b.intern() ：同 1 所述</li>
 <li>b == c ：c 我们看到首先是 ldc，获取到JVM生成的String，然后再次调用new String，将JVM生成的String放入其中，所以 为 false：两个对象都不是同一个</li>
 <li>c == c.intern() ： 由于 "abc" 已经存在于StringTable中，所以c.intern()返回的是1 ldc放入到的对象，自然为false</li>
 <li>d == d.intern() ：同 4 所述，"abce" 已经存在一个JVM 在 ldc时创建的 java 字符串对象</li>
 <li>e == e.intern() ：该对象为动态 a + b 生成，在StringTable中不存在对应向，所以这里intern 时将 e 对象保存在了StringTable中，所以返回为 e对象，自然为 true</li>
</ol>
<p><span style="color: rgb(200, 143, 208);">public</span> <span style="color: rgb(200, 143, 208);">class</span> <span style="color: rgb(141, 141, 240);">Demo</span> {</p>
<p>&nbsp;&nbsp;<span style="color: rgb(200, 143, 208);">public</span> <span style="color: rgb(200, 143, 208);">static</span> <span style="color: rgb(28, 198, 133);">void</span> <span style="color: rgb(184, 191, 198);">main</span>(<span style="color: rgb(28, 198, 133);">String</span>[] <span style="color: rgb(184, 191, 198);">args</span>){</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(210, 107, 107);">"abc"</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">b</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(210, 107, 107);">"ab"</span> <span style="color: rgb(184, 191, 198);">+</span> <span style="color: rgb(210, 107, 107);">"c"</span>;</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">c</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(200, 143, 208);">new</span> <span style="color: rgb(28, 198, 133);">String</span>(<span style="color: rgb(210, 107, 107);">"abc"</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">d</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(200, 143, 208);">new</span> <span style="color: rgb(28, 198, 133);">String</span>(<span style="color: rgb(210, 107, 107);">"abce"</span>);</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(28, 198, 133);">String</span> <span style="color: rgb(184, 191, 198);">e</span> <span style="color: rgb(184, 191, 198);">=</span> <span style="color: rgb(200, 143, 208);">new</span> <span style="color: rgb(28, 198, 133);">String</span>( <span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">+</span> <span style="color: rgb(184, 191, 198);">b</span> );</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">a</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">a</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">b</span>); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">b</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">b</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">b</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">c</span>); <span style="color: rgb(218, 146, 74);">// false</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">c</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">c</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// false</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">d</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">d</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// false</span></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: rgb(184, 191, 198);">System</span>.<span style="color: rgb(184, 191, 198);">out</span>.<span style="color: rgb(184, 191, 198);">println</span>(<span style="color: rgb(184, 191, 198);">e</span> <span style="color: rgb(184, 191, 198);">==</span> <span style="color: rgb(184, 191, 198);">e</span>.<span style="color: rgb(184, 191, 198);">intern</span>()); <span style="color: rgb(218, 146, 74);">// true</span></p>
<p>&nbsp;}</p>
<p>}</p>
<p>JVM的StringTable 与 SymbolTable设计，与 ELF 的 StringTable 和 SymbolTable一样，都是将字面量编码保存与实际字符元数据分离，这样可以让不同元数据共享同一个字面量编码~，只不过在ELF中StringTable 保存字面量，而SymbolTable保存索引下标，在JVM中恰好相反~表现了自己的不同~，就是颠倒下语义和单词。</p>
<p>最后：基础不牢地动山摇~，与其在上层玩，不如来底层专研，因为底层学通，上层自然通。</p>
<p>物有本末，事有终始，知其先后，则近道矣</p>
<p><br></p></p>
</body>
</html>